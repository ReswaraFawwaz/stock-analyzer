<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time Stock Analyzer Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .api-setup {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .api-setup h3 {
            color: #ffd700;
            margin-bottom: 10px;
        }
        
        .api-setup p {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .input-section {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .input-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        input, button, select {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
        }
        
        input, select {
            background: rgba(255,255,255,0.9);
            color: #333;
            flex: 1;
            min-width: 200px;
        }
        
        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .card h3 {
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .metric:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            font-weight: bold;
        }
        
        .metric-value {
            color: #4ecdc4;
        }
        
        .signal {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }
        
        .buy { background: #2ecc71; }
        .sell { background: #e74c3c; }
        .hold { background: #f39c12; }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
        }
        
        .error {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid #e74c3c;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .warning {
            background: rgba(241, 196, 15, 0.2);
            border: 1px solid #f1c40f;
            color: #f1c40f;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .presets {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .preset-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .preset-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .data-source {
            font-size: 12px;
            opacity: 0.7;
            text-align: center;
            margin-top: 10px;
        }
        
        .timestamp {
            font-size: 12px;
            opacity: 0.8;
            text-align: center;
            margin-bottom: 15px;
            color: #4ecdc4;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Real-time Stock Analyzer Pro</h1>
            <p>Analisis Teknikal & Fundamental dengan Data Real-time</p>
        </div>
        
        <div class="api-setup">
            <h3>üîë Setup API Key (One-time Setup)</h3>
            <p>Untuk data real-time, masukkan API key dari Alpha Vantage (gratis): <a href="https://www.alphavantage.co/support/#api-key" target="_blank" style="color: #4ecdc4;">Get Free API Key</a></p>
            <div class="input-group">
                <input type="password" id="apiKey" placeholder="Masukkan Alpha Vantage API Key" />
                <button onclick="saveApiKey()">Save API Key</button>
            </div>
            <p style="font-size: 12px; opacity: 0.7;">API key disimpan di browser ini saja (tidak dikirim ke server manapun)</p>
        </div>
        
        <div class="input-section">
            <div class="input-group">
                <input type="text" id="stockSymbol" placeholder="Masukkan symbol saham (contoh: AAPL, NVDA)" />
                <select id="analysisType">
                    <option value="both">Technical + Fundamental</option>
                    <option value="technical">Technical Only</option>
                    <option value="fundamental">Fundamental Only</option>
                </select>
                <button onclick="analyzeStock()" id="analyzeBtn">Analisis Real-time</button>
            </div>
            
            <div class="presets">
                <div class="preset-btn" onclick="setSymbol('NVDA')">NVIDIA</div>
                <div class="preset-btn" onclick="setSymbol('AAPL')">Apple</div>
                <div class="preset-btn" onclick="setSymbol('GOOGL')">Google</div>
                <div class="preset-btn" onclick="setSymbol('MSFT')">Microsoft</div>
                <div class="preset-btn" onclick="setSymbol('TSLA')">Tesla</div>
                <div class="preset-btn" onclick="setSymbol('AMZN')">Amazon</div>
                <div class="preset-btn" onclick="setSymbol('META')">Meta</div>
                <div class="preset-btn" onclick="setSymbol('NFLX')">Netflix</div>
            </div>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        // API Configuration
        const API_BASE_URL = 'https://www.alphavantage.co/query';
        let API_KEY = localStorage.getItem('alpha_vantage_api_key') || '';
        
        // Initialize
        window.onload = function() {
            if (API_KEY) {
                document.getElementById('apiKey').value = API_KEY;
            }
        };
        
        function saveApiKey() {
            const key = document.getElementById('apiKey').value.trim();
            if (key) {
                API_KEY = key;
                localStorage.setItem('alpha_vantage_api_key', key);
                alert('‚úÖ API Key tersimpan! Sekarang bisa analisis real-time.');
            }
        }
        
        function setSymbol(symbol) {
            document.getElementById('stockSymbol').value = symbol;
        }
        
        async function analyzeStock() {
            const symbol = document.getElementById('stockSymbol').value.toUpperCase().trim();
            const analysisType = document.getElementById('analysisType').value;
            const resultsDiv = document.getElementById('results');
            const analyzeBtn = document.getElementById('analyzeBtn');
            
            if (!symbol) {
                resultsDiv.innerHTML = '<div class="error">‚ùå Mohon masukkan symbol saham!</div>';
                return;
            }
            
            if (!API_KEY) {
                resultsDiv.innerHTML = '<div class="error">‚ùå Mohon masukkan API Key terlebih dahulu!</div>';
                return;
            }
            
            // Disable button and show loading
            analyzeBtn.disabled = true;
            analyzeBtn.textContent = 'Menganalisis...';
            resultsDiv.innerHTML = '<div class="loading">üîÑ Mengambil data real-time dari pasar saham...</div>';
            
            try {
                const analysisData = await getRealTimeStockData(symbol);
                displayResults(analysisData, analysisType);
                
            } catch (error) {
                console.error('Error:', error);
                resultsDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            } finally {
                // Re-enable button
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = 'Analisis Real-time';
            }
        }
        
        async function getRealTimeStockData(symbol) {
            try {
                // Get real-time quote data
                const quoteResponse = await fetch(`${API_BASE_URL}?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=${API_KEY}`);
                const quoteData = await quoteResponse.json();
                
                if (quoteData['Error Message']) {
                    throw new Error(`Symbol '${symbol}' tidak ditemukan. Pastikan symbol benar (contoh: AAPL, GOOGL)`);
                }
                
                if (quoteData['Note']) {
                    throw new Error('API limit tercapai. Tunggu 1 menit atau upgrade ke premium API key.');
                }
                
                const quote = quoteData['Global Quote'];
                if (!quote) {
                    throw new Error('Data tidak tersedia. Coba symbol saham yang berbeda.');
                }
                
                // Get company overview for fundamental data
                const overviewResponse = await fetch(`${API_BASE_URL}?function=OVERVIEW&symbol=${symbol}&apikey=${API_KEY}`);
                const overviewData = await overviewResponse.json();
                
                // Get technical indicators (RSI)
                const rsiResponse = await fetch(`${API_BASE_URL}?function=RSI&symbol=${symbol}&interval=daily&time_period=14&series_type=close&apikey=${API_KEY}`);
                const rsiData = await rsiResponse.json();
                
                // Get MACD
                const macdResponse = await fetch(`${API_BASE_URL}?function=MACD&symbol=${symbol}&interval=daily&series_type=close&apikey=${API_KEY}`);
                const macdData = await macdResponse.json();
                
                // Process the data
                return processStockData(quote, overviewData, rsiData, macdData, symbol);
                
            } catch (error) {
                if (error.message.includes('fetch')) {
                    throw new Error('Gagal terhubung ke API. Periksa koneksi internet Anda.');
                }
                throw error;
            }
        }
        
        function processStockData(quote, overview, rsiData, macdData, symbol) {
            // Extract quote data
            const price = parseFloat(quote['05. price']);
            const change = parseFloat(quote['09. change']);
            const changePercent = quote['10. change percent'].replace('%', '');
            const volume = parseInt(quote['06. volume']);
            const highPrice = parseFloat(quote['03. high']);
            const lowPrice = parseFloat(quote['02. low']);
            const openPrice = parseFloat(quote['07. previous close']);
            
            // Extract fundamental data
            const peRatio = parseFloat(overview['PERatio']) || 0;
            const marketCap = parseFloat(overview['MarketCapitalization']) || 0;
            const dividendYield = parseFloat(overview['DividendYield']) * 100 || 0;
            const debtToEquity = parseFloat(overview['DebtToEquityRatio']) || 0;
            const roe = parseFloat(overview['ReturnOnEquityTTM']) * 100 || 0;
            const revenueGrowth = parseFloat(overview['RevenueGrowthTTM']) * 100 || 0;
            const bookValue = parseFloat(overview['BookValue']) || 0;
            const eps = parseFloat(overview['EPS']) || 0;
            
            // Extract technical indicators
            let rsi = 50; // default
            let macd = 0; // default
            let macdSignal = 0;
            
            try {
                // Get latest RSI value
                const rsiTimeSeries = rsiData['Technical Analysis: RSI'];
                if (rsiTimeSeries) {
                    const latestRsiDate = Object.keys(rsiTimeSeries)[0];
                    rsi = parseFloat(rsiTimeSeries[latestRsiDate]['RSI']);
                }
                
                // Get latest MACD values
                const macdTimeSeries = macdData['Technical Analysis: MACD'];
                if (macdTimeSeries) {
                    const latestMacdDate = Object.keys(macdTimeSeries)[0];
                    const macdEntry = macdTimeSeries[latestMacdDate];
                    macd = parseFloat(macdEntry['MACD']);
                    macdSignal = parseFloat(macdEntry['MACD_Signal']);
                }
            } catch (e) {
                console.warn('Technical indicators not available, using defaults');
            }
            
            // Calculate additional metrics
            const pbRatio = bookValue > 0 ? price / bookValue : 0;
            const marketCapBillions = marketCap / 1000000000;
            
            return {
                symbol: symbol,
                price: price.toFixed(2),
                change: change.toFixed(2),
                changePercent: changePercent,
                volume: volume.toLocaleString(),
                high: highPrice.toFixed(2),
                low: lowPrice.toFixed(2),
                open: openPrice.toFixed(2),
                
                // Technical indicators
                rsi: rsi,
                macd: macd,
                macdSignal: macdSignal,
                
                // Fundamental data
                pe_ratio: peRatio,
                pb_ratio: pbRatio,
                market_cap: marketCapBillions,
                dividend_yield: dividendYield,
                debt_to_equity: debtToEquity,
                roe: roe,
                revenue_growth: revenueGrowth,
                eps: eps,
                book_value: bookValue,
                
                // Company info
                company_name: overview['Name'] || symbol,
                sector: overview['Sector'] || 'N/A',
                industry: overview['Industry'] || 'N/A',
                
                timestamp: new Date().toLocaleString('id-ID')
            };
        }
        
        function displayResults(data, analysisType) {
            const resultsDiv = document.getElementById('results');
            let html = '';
            
            // Timestamp
            html += `<div class="timestamp">üìÖ Data diperbarui: ${data.timestamp}</div>`;
            
            html += '<div class="results-grid">';
            
            // Company Info & Price Card
            html += `
                <div class="card">
                    <h3>üè¢ ${data.company_name}</h3>
                    <div class="metric">
                        <span class="metric-label">Symbol:</span>
                        <span class="metric-value">${data.symbol}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Sector:</span>
                        <span class="metric-value">${data.sector}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Industry:</span>
                        <span class="metric-value">${data.industry}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Harga Saat Ini:</span>
                        <span class="metric-value" style="font-size: 1.2rem; font-weight: bold;">$${data.price}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Perubahan:</span>
                        <span class="metric-value" style="color: ${data.change >= 0 ? '#2ecc71' : '#e74c3c'}; font-weight: bold;">
                            ${data.change >= 0 ? '+' : ''}${data.change} (${data.changePercent}%)
                        </span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Volume:</span>
                        <span class="metric-value">${data.volume}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">High/Low:</span>
                        <span class="metric-value">$${data.high} / $${data.low}</span>
                    </div>
                </div>
            `;
            
            // Technical Analysis
            if (analysisType === 'both' || analysisType === 'technical') {
                const rsi = data.rsi;
                const rsiSignal = rsi > 70 ? 'OVERBOUGHT (JUAL)' : rsi < 30 ? 'OVERSOLD (BELI)' : 'NETRAL';
                const rsiClass = rsi > 70 ? 'sell' : rsi < 30 ? 'buy' : 'hold';
                
                const macdDiff = data.macd - data.macdSignal;
                const macdSignal = macdDiff > 0 ? 'BULLISH (BELI)' : 'BEARISH (JUAL)';
                const macdClass = macdDiff > 0 ? 'buy' : 'sell';
                
                html += `
                    <div class="card">
                        <h3>üìà Analisis Teknikal Real-time</h3>
                        <div class="metric">
                            <span class="metric-label">RSI (14):</span>
                            <span class="metric-value">${rsi.toFixed(2)}</span>
                        </div>
                        <div class="signal ${rsiClass}">RSI: ${rsiSignal}</div>
                        
                        <div class="metric">
                            <span class="metric-label">MACD:</span>
                            <span class="metric-value">${data.macd.toFixed(4)}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">MACD Signal:</span>
                            <span class="metric-value">${data.macdSignal.toFixed(4)}</span>
                        </div>
                        <div class="signal ${macdClass}">MACD: ${macdSignal}</div>
                        
                        <div class="data-source">üîÑ Data teknikal real-time dari Alpha Vantage</div>
                    </div>
                `;
            }
            
            // Fundamental Analysis
            if (analysisType === 'both' || analysisType === 'fundamental') {
                const peRatio = data.pe_ratio;
                const peSignal = peRatio > 25 ? 'OVERVALUED (MAHAL)' : peRatio < 15 ? 'UNDERVALUED (MURAH)' : peRatio > 0 ? 'FAIR VALUE' : 'DATA N/A';
                const peClass = peRatio > 25 ? 'sell' : peRatio < 15 ? 'buy' : 'hold';
                
                html += `
                    <div class="card">
                        <h3>üí∞ Analisis Fundamental Real-time</h3>
                        <div class="metric">
                            <span class="metric-label">P/E Ratio:</span>
                            <span class="metric-value">${peRatio > 0 ? peRatio.toFixed(2) : 'N/A'}</span>
                        </div>
                        ${peRatio > 0 ? `<div class="signal ${peClass}">Valuasi: ${peSignal}</div>` : ''}
                        
                        <div class="metric">
                            <span class="metric-label">P/B Ratio:</span>
                            <span class="metric-value">${data.pb_ratio > 0 ? data.pb_ratio.toFixed(2) : 'N/A'}</span>
                        </div>
                        
                        <div class="metric">
                            <span class="metric-label">Market Cap:</span>
                            <span class="metric-value">${data.market_cap > 0 ? '$' + data.market_cap.toFixed(1) + 'B' : 'N/A'}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">EPS:</span>
                            <span class="metric-value">${data.eps > 0 ? '$' + data.eps.toFixed(2) : 'N/A'}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Dividend Yield:</span>
                            <span class="metric-value">${data.dividend_yield > 0 ? data.dividend_yield.toFixed(2) + '%' : 'N/A'}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Debt to Equity:</span>
                            <span class="metric-value">${data.debt_to_equity > 0 ? data.debt_to_equity.toFixed(2) : 'N/A'}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ROE:</span>
                            <span class="metric-value">${data.roe !== 0 ? data.roe.toFixed(2) + '%' : 'N/A'}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Revenue Growth:</span>
                            <span class="metric-value">${data.revenue_growth !== 0 ? data.revenue_growth.toFixed(2) + '%' : 'N/A'}</span>
                        </div>
                        
                        <div class="data-source">üìä Data fundamental real-time dari Alpha Vantage</div>
                    </div>
                `;
            }
            
            // Overall Signal Analysis
            const signals = [];
            let signalCount = 0;
            
            if (analysisType === 'both' || analysisType === 'technical') {
                if (data.rsi < 30) { signals.push('buy'); signalCount++; }
                else if (data.rsi > 70) { signals.push('sell'); signalCount++; }
                else { signals.push('hold'); signalCount++; }
                
                const macdDiff = data.macd - data.macdSignal;
                if (macdDiff > 0) { signals.push('buy'); signalCount++; }
                else { signals.push('sell'); signalCount++; }
            }
            
            if (analysisType === 'both' || analysisType === 'fundamental') {
                if (data.pe_ratio > 0) {
                    if (data.pe_ratio < 15) { signals.push('buy'); signalCount++; }
                    else if (data.pe_ratio > 25) { signals.push('sell'); signalCount++; }
                    else { signals.push('hold'); signalCount++; }
                }
            }
            
            const buyCount = signals.filter(s => s === 'buy').length;
            const sellCount = signals.filter(s => s === 'sell').length;
            const holdCount = signals.filter(s => s === 'hold').length;
            
            let overallSignal, overallClass, confidence;
            if (buyCount > sellCount && buyCount > holdCount) {
                overallSignal = 'STRONG BUY üöÄ';
                overallClass = 'buy';
                confidence = Math.round((buyCount / signalCount) * 100);
            } else if (sellCount > buyCount && sellCount > holdCount) {
                overallSignal = 'STRONG SELL üìâ';
                overallClass = 'sell';
                confidence = Math.round((sellCount / signalCount) * 100);
            } else {
                overallSignal = 'HOLD ‚öñÔ∏è';
                overallClass = 'hold';
                confidence = Math.round((Math.max(buyCount, sellCount, holdCount) / signalCount) * 100);
            }
            
            html += `
                <div class="card">
                    <h3>üéØ Rekomendasi AI Real-time</h3>
                    <div class="signal ${overallClass}" style="font-size: 1.3rem; margin: 20px 0;">
                        ${overallSignal}
                    </div>
                    <div class="metric">
                        <span class="metric-label">Confidence Level:</span>
                        <span class="metric-value">${confidence}%</span>
                    </div>
                    <div style="font-size: 0.9rem; opacity: 0.8; text-align: center; margin-top: 15px;">
                        Berdasarkan ${signalCount} indikator real-time<br>
                        üü¢ Buy: ${buyCount} | üî¥ Sell: ${sellCount} | üü° Hold: ${holdCount}
                    </div>
                    <div class="warning" style="margin-top: 15px; font-size: 0.8rem;">
                        ‚ö†Ô∏è Ini analisis otomatis berdasarkan data real-time. Selalu lakukan riset mendalam dan konsultasi dengan ahli sebelum investasi!
                    </div>
                </div>
            `;
            
            html += '</div>';
            resultsDiv.innerHTML = html;
        }
    </script>
</body>
</html>